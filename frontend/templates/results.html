{% extends "base.html" %}

{% block content %}
<style>
    .hover-link:hover {
        text-decoration: underline !important;
        color: #0d6efd !important;
        /* Bootstrap primary color */
    }

    .hover-link-badge:hover {
        background-color: #e9ecef !important;
        cursor: pointer;
        color: #0d6efd !important;
    }
</style>
<div class="container mt-5">
    <h2 class="mb-4 fw-bold">Prediction Results</h2>
    <div class="alert alert-light border shadow-sm">
        Showing results for Rank: <strong>{{ rank }}</strong> | Category: <strong>{{ category }}</strong>
    </div>

    <!-- Search Input -->
    <div class="mb-3">
        <input type="text" id="resultSearch" class="form-control" placeholder="Search for College or Branch name...">
    </div>

    {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    {% if results %}
    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="bg-light">
                        <tr>
                            <th class="py-3 px-4">College Code</th>
                            <th class="py-3 px-4">College</th>
                            <th class="py-3 px-4">Course</th>
                            <th class="py-3 px-4">Round</th>
                            <th class="py-3 px-4">Category</th>
                            <th class="py-3 px-4">Predicted Closing Rank</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in results %}
                        <tr>
                            <td class="py-3 px-4">
                                <span class="badge bg-primary bg-opacity-10 text-primary">{{ row.college_code }}</span>
                            </td>
                            <td class="py-3 px-4">
                                {% if row.college_code %}
                                <a href="/college/{{ row.college_code }}"
                                    class="text-decoration-none fw-semibold text-dark hover-link">{{ row.college_name
                                    }}</a>
                                {% else %}
                                {{ row.college_name }}
                                {% endif %}
                            </td>
                            <td class="py-3 px-4">
                                {% if row.branch_code or row.branch %}
                                <a href="/courses?code={{ row.branch_code or row.branch }}"
                                    class="text-decoration-none text-dark hover-link course-link"
                                    title="View Course Details">
                                    {% set course_name = (row.course_full_name or row.branch) %}
                                    {% if (row.branch_code or row.branch)|upper == 'AT' %}
                                        B.ARCH <span class="badge bg-light text-dark border ms-1">AT</span>
                                    {% else %}
                                        {{ course_name }} <span class="badge bg-light text-dark border ms-1">{{ (row.branch_code or row.branch)|upper }}</span>
                                    {% endif %}
                                </a>
                                {% else %}
                                {{ row.course_full_name or row.branch }}
                                {% endif %}
                            </td>

                            <td class="py-3 px-4"><span class="badge bg-secondary bg-opacity-10 text-secondary">{{
                                    row.round }}</span></td>
                            <td class="py-3 px-4">{{ row.category }}</td>
                            <td class="py-3 px-4"><span class="badge bg-success bg-opacity-10 text-success">{{
                                    row.predicted_closing_rank }}</span></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% else %}
    <div class="alert alert-warning shadow-sm border-0">
        <i class="fas fa-exclamation-triangle me-2"></i> No predictions found for the provided rank and category.
    </div>
    {% endif %}

    <div class="mt-4">
        <a href="/predictor" class="btn btn-primary px-4 rounded-pill"><i class="fas fa-arrow-left me-2"></i>Check
            Again</a>
    </div>
</div>
<script>
    document.getElementById('resultSearch').addEventListener('keyup', function () {
        var searchValue = this.value.trim().toLowerCase();
        var rows = document.querySelectorAll('table tbody tr');

        rows.forEach(function (row) {
            var collegeCode = row.cells[0].textContent.trim().toLowerCase();
            var collegeName = row.cells[1].textContent.trim().toLowerCase();
            var course = row.cells[2].textContent.trim().toLowerCase();
            var round = row.cells[3].textContent.trim().toLowerCase();
            var category = row.cells[4].textContent.trim().toLowerCase();
            // If you have a location column, add: var location = row.cells[5].textContent.trim().toLowerCase();

            if (
                collegeCode.includes(searchValue) ||
                collegeName.includes(searchValue) ||
                course.includes(searchValue) ||
                round.includes(searchValue) ||
                category.includes(searchValue)
                // || location.includes(searchValue) // Uncomment if location column exists
            ) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}